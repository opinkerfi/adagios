(function(e){"use strict";var t=function(t,n){this.options=n;this.table=t;this.currentPage=0;this.currentStart=0;this.filterIndex=[];this.table.addClass(this.options.tableClass);if(this.options.nbColumns<0){this.options.nbColumns=this.table.find("thead tr").first().find("th").length}e(this.options.pagingDivSelector).addClass("pagination-data-tables").addClass(this.options.pagingDivClass);var r=e("<ul></ul>");r.addClass(this.options.pagingListClass);e(this.options.pagingDivSelector).html("").append(r);var i=this;if(this.table.find("thead").length===0){var s=e("<thead></thead>");s.append(this.table.find("th").parent("tr"));this.table.prepend(s)}if(this.table.find("tbody").length===0){e("<tbody></tbody>").insertAfter(this.table.find("thead").first())}if(jQuery.isArray(this.options.data)){this.data=this.options.data}else if(jQuery.isPlainObject(this.options.data)){if(this.table.data("size")){this.options.data.size=parseInt(this.table.data("size"),10)}if(this.options.data.refresh===undefined){this.options.data.refresh=false}this.data=[];if(this.options.data.size!==undefined){e(this.options.loadingDivSelector).html('<div class="progress progress-striped active datatable-load-bar"><div class="bar" style="width: 0%;"></div></div>');for(var o=0;o<this.options.data.size;o+=this.options.pageSize*this.options.pagingNumberOfPages){this.getAjaxDataAsync(o)}}else{e(this.options.loadingDivSelector).html('<div class="progress progress-striped active datatable-load-bar"><div class="bar" style="width: 100%;"></div></div>');this.getAjaxDataSync()}}else{this.data=[];this.table.find("tbody tr").each(function(){var t=[];e(this).find("td").each(function(){t.push(e(this).html())});i.data.push(t)})}this.createSort();this.createFilter();this.triggerSort();this.filter()};t.prototype={constructor:t,clearAjaxLoading:function(){if(this.options.data.refresh){this.refreshTimeOut=setTimeout(function(e){return function(){e.getAjaxDataSync(0,true)}}(this),this.options.data.refresh)}},hideLoadingDivs:function(){this.getLoadingDivs().remove()},updateLoadingDivs:function(){if(this.data.length===this.options.data.size){this.clearAjaxLoading();this.hideLoadingDivs()}else{this.getLoadingDivs().find("div.progress .bar").css("width",parseInt(100*this.data.length/this.options.data.size,10)+"%")}},getAjaxDataAsync:function(t){e.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:t,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:t,ajaxThis:this,success:function(e,t,n){this.ajaxThis.data=this.ajaxThis.data.concat(e);this.ajaxThis.sort();this.ajaxThis.filter(true);this.ajaxThis.updateLoadingDivs()},error:function(e,t,n){console.log("ERROR: "+n+" - "+t);this.ajaxThis.getAjaxDataAsync(this.ajaxI)}})},getAjaxDataSync:function(t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=false}if(n&&this.syncData===undefined){this.syncData=[]}e.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:t,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:t,ajaxAllInOne:n,ajaxThis:this,success:function(e,t,n){if(e.length!==0){if(this.ajaxAllInOne){this.ajaxThis.syncData=this.ajaxThis.syncData.concat(e)}else{this.ajaxThis.data=this.ajaxThis.data.concat(e);this.ajaxThis.sort();this.ajaxThis.filter(true)}this.ajaxThis.getAjaxDataSync(this.ajaxI+this.ajaxThis.options.pageSize*this.ajaxThis.options.pagingNumberOfPages,this.ajaxAllInOne)}else{if(this.ajaxAllInOne){this.ajaxThis.data=this.ajaxThis.syncData;delete this.ajaxThis.syncData}this.ajaxThis.clearAjaxLoading();this.ajaxThis.hideLoadingDivs();this.ajaxThis.sort();this.ajaxThis.filter(true)}},error:function(e,t,n){console.log("ERROR: "+n+" - "+t);this.ajaxThis.getAjaxDataSync(this.ajaxI,this.ajaxAllInOne)}})},getHead:function(){return this.table.find("thead").first()},getBody:function(){return this.table.find("tbody").first()},getCounter:function(){return e(this.options.counterDivSelector)},getLoadingDivs:function(){return e(this.options.loadingDivSelector)},getPagingLists:function(){return e(this.options.pagingDivSelector).find("ul")},getLastPageNumber:function(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function(){var t=this.options.pagingNumberOfPages;var n=this;var r=parseInt(this.currentStart/this.options.pageSize,10)+1;var i=this.getLastPageNumber();var s;var o;if(r<t/2){s=1}else if(r>=i-t/2){s=i-t+1;if(s<1){s=1}}else{s=parseInt(r-t/2+1,10)}if(s+t<i+1){o=s+t-1}else{o=i}this.getPagingLists().each(function(){e(this).html("");if(n.options.firstPage){e(this).append('<li class="'+(r===1?"active":"")+'"><a data-page="first">'+n.options.firstPage+"</a></li>")}if(n.options.prevPage){e(this).append('<li class="'+(r===1?"active":"")+'"><a data-page="prev">'+n.options.prevPage+"</a></li>")}for(var t=s;t<=o;t++){e(this).append('<li class="'+(t===r?"active":"")+'"><a data-page="'+t+'">'+t+"</a></li>")}if(n.options.nextPage){e(this).append('<li class="'+(r===i||i===0?"active":"")+'"><a data-page="next">'+n.options.nextPage+"</a></li>")}if(n.options.lastPage){e(this).append('<li class="'+(r===i||i===0?"active":"")+'"><a data-page="last">'+n.options.lastPage+"</a></li>")}});this.getPagingLists().find("a").on("click.datatable",function(){if(e(this).parent("li").hasClass("active")){return}var t=e(this).data("page");switch(t){case"first":n.loadPage(1);break;case"prev":n.loadPage(r-1);break;case"next":n.loadPage(r+1);break;case"last":n.loadPage(i);break;default:n.loadPage(parseInt(t,10))}})},updateCounter:function(){var e=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0;var t=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10);var n=this.filterIndex.length?this.currentStart+1:0;var r=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;this.getCounter().html(this.options.counterText(e,t,n,r,this.filterIndex.length))},getSortFunction:function(){if(this.options.sort===false){return false}if(jQuery.isFunction(this.options.sort)){return this.options.sort}if(this.data.length===0||!(this.options.sortKey in this.data[0])){return false}var e=this.options.sortKey;var t=this.options.sortDir==="asc";return function(n,r){var i=n[e],s=r[e];if(i>s){return t?1:-1}if(i<s){return t?-1:1}return 0}},destroyFilter:function(){e(".datatable-filter-line").remove()},changePlaceHolder:function(){var t=this.options.filterText?this.options.filterText:"";e('.datatable-filter-line input[type="text"]').attr("placeholder",t)},createTextFilter:function(t){var n=this.options.filterText?'placeholder="'+this.options.filterText+'"':"";var r=e('<input type="text" class="datatable-filter datatable-input-text" data-filter="'+t+'" '+n+"/>");this.filterVals[t]="";var i=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();r.on("change keyup keydown",function(t){return function(){var n=e(this).val().toUpperCase();var r=e(this).data("filter");i(function(){t.filterVals[r]=n;t.filter()},300)}}(this));this.addFilter(t,function(e,t){return e.toUpperCase().indexOf(t)!==-1});r.addClass(this.options.filterInputClass);return r},createSelectFilter:function(t){var n={},r=[],i=false,s=true,o="";if(this.options.filters[t]==="select"){n=this.getFilterOptions(t)}else{i="multiple"in this.options.filters[t]&&this.options.filters[t].multiple===true;s="empty"in this.options.filters[t]&&this.options.filters[t].empty;o="empty"in this.options.filters[t]&&typeof this.options.filters[t].empty==="string"?this.options.filters[t].empty:"";if("values"in this.options.filters[t]){if(this.options.filters[t].values==="auto"){n=this.getFilterOptions(t)}else{n=this.options.filters[t].values}if("default"in this.options.filters[t]){r=this.options.filters[t].default}else if(i){r=[];for(var u in n){if(e.isPlainObject(n[u])){r=r.concat(Object.keys(n[u]))}else{r.push(u)}}}else{r=[]}if(!e.isArray(r)){r=[r]}}else{n=this.options.filters[t];r=i?Object.keys(n):[]}}var a=e("<select "+(i?'multiple="multiple"':"")+' class="datatable-filter datatable-select" data-filter="'+t+'"></select>');if(s){a.append('<option value="">'+o+"</option>")}var f=[];for(var l in n){if(e.isPlainObject(n[l])){var c=e('<optgroup label="'+l+'"></optgroup>');for(var h in n[l]){if(n[l].hasOwnProperty(h)){f.push(h);c.append('<option value="'+h+'" '+(r.indexOf(h)!==-1||r.indexOf(parseInt(h))!==-1?"selected":"")+">"+n[l][h]+"</option>")}}a.append(c)}else{f.push(l);a.append('<option value="'+l+'" '+(r.indexOf(l)!==-1||r.indexOf(parseInt(l))!==-1?"selected":"")+">"+n[l]+"</option>")}}var p=a.val();this.filterVals[t]=i?p:s&&!p?f:[p];a.change(function(t,n,r,i){return function(){var s=e(this).val();var o=e(this).data("filter");i.filterVals[o]=n?s:r&&!s?t:[s];i.filter()}}(f,i,s,this));this.addFilter(t,function(e){return function(t,n){if(!n){return false}if(n==e&&!t){return true}return n.indexOf(t)!==-1}}(f));a.addClass(this.options.filterSelectClass);return a},createFilter:function(){this.filters=[];this.filterVals=[];if(this.options.filters){var t=e('<tr class="datatable-filter-line"></tr>').insertAfter(this.table.find("thead tr").last());for(var n in this.options.filters){if(this.options.filters.hasOwnProperty(n)){var r=e("<td></td>");if(this.options.filters[n]!==false){if(this.options.filters[n]===true){r.append(this.createTextFilter(n))}else{r.append(this.createSelectFilter(n))}}t.append(r)}}}},filter:function(e){if(typeof e==="undefined"){e=false}var t=this.currentStart;this.currentStart=0;this.filterIndex=[];for(var n=0;n<this.data.length;n++){if(this.checkFilter(this.data[n])){this.filterIndex.push(n)}}if(e){this.currentStart=t;while(this.currentStart>=this.filterIndex.length){this.currentStart-=this.options.pageSize}if(this.currentStart<0){this.currentStart=0}}this.refresh()},checkFilter:function(e){var t=true;for(var n in this.filters){if(!this.filters[n](e[n],this.filterVals[n])){if(e["serie"]=="Absurdomanies"){console.log("absurde = "+n+", "+e[n]+", "+this.filterVals[n])}t=false;break}}return t},addFilter:function(e,t){this.filters[e]=t},getFilterOptions:function(e){var t={},n=[];for(var r in this.data){if(this.data[r][e]!==""){n.push(this.data[r][e])}}n.sort();for(var i in n){if(n.hasOwnProperty(i)){t[n[i]]=n[i]}}return t},destroySort:function(){e("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function(){var t=this;if(!jQuery.isFunction(this.options.sort)){var n=0;this.table.find("thead th").each(function(){if(e(this).data("sort")){t.options.sort=true}else if(t.options.sort==="*"){e(this).data("sort",n)}else{var r;if(jQuery.isArray(t.options.sort)){r=n}else if(jQuery.isPlainObject(t.options.sort)){r=Object.keys(t.options.sort)[n]}if(r!==undefined&&t.options.sort[r]){e(this).data("sort",r)}}if(e(this).data("sort")!==undefined){e(this).addClass("sorting")}n++});this.table.find("thead th").on("click.datatable",function(){if(e(this).data("sort")!==undefined){if(e(this).hasClass("sorting-asc")){t.options.sortDir="desc";e(this).removeClass("sorting-asc").addClass("sorting-desc")}else if(e(this).hasClass("sorting-desc")){t.options.sortDir="asc";e(this).removeClass("sorting-desc").addClass("sorting-asc")}else{e(this).parent("tr").find("th").removeClass("sorting-desc").removeClass("sorting-asc");t.options.sortDir="asc";t.options.sortKey=e(this).data("sort");e(this).addClass("sorting-asc")}t.sort();t.refresh()}})}},triggerSort:function(){if(jQuery.isFunction(this.options.sort)){this.sort();this.refresh()}else if(this.options.sortKey!==false){var t;this.table.find("tr th").removeClass("sorting-desc").removeClass("sorting-asc");this.table.find("th").each(function(n){return function(){if(e(this).data("sort")===n){t=e(this)}}}(this.options.sortKey));if(t!==undefined){t.addClass("sorting-"+this.options.sortDir);this.sort();this.refresh()}}},sort:function(){var e=this.getSortFunction();if(e===false){return}this.data.sort(e)},identify:function(t,n){if(this.options.identify===false){return false}if(e.isFunction(this.options.identify)){return this.options.identify(t,n)}return n[this.options.identify]==t},indexOf:function(e){var t=-1;for(var n=0;n<this.data.length&&t===-1;n++){if(this.identify(e,this.data[n])){t=n}}return t},row:function(e){return this.data[this.indexOf(e)]},addRow:function(e){this.data.push(e);this.sort();this.filter();this.currentStart=parseInt(this.filterIndex.indexOf(this.data.indexOf(e))/this.options.pageSize,10)*this.options.pageSize;this.refresh()},deleteRow:function(e){var t=this.currentStart;var n=this.indexOf(e);if(n===-1){console.log("No data found with id: "+e);return}this.data.splice(n,1);this.filter();if(t<this.filterIndex.length){this.currentStart=t}else{this.currentStart=t-this.options.pageSize;if(this.currentStart<0){this.currentStart=0}}this.refresh()},updateRow:function(e,t){var n=this.indexOf(e);if(n!==-1){if(e in t){delete t[e]}for(var r in this.data[n]){if(r in t){this.data[n][r]=t[r]}}this.sort();this.filter();this.currentStart=parseInt(this.filterIndex.indexOf(this.indexOf(e))/this.options.pageSize,10)*this.options.pageSize;this.refresh()}},loadPage:function(e){var t=this.currentStart/this.options.pageSize;if(e<1){e=1}else if(e>this.getLastPageNumber()){e=this.getLastPageNumber()}this.currentStart=(e-1)*this.options.pageSize;this.refresh();this.options.onChange(t+1,e)},getCurrentPage:function(){return this.currentStart/this.options.pageSize+1},refresh:function(){this.options.beforeRefresh();this.updatePaging();this.updateCounter();this.getBody().html("");if(this.currentStart>=this.currentDataLength){this.getBody().append('<tr><td colspan="'+this.options.nbColumns+'"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></tr>');return}for(var e=0;e<this.options.pageSize&&e+this.currentStart<this.filterIndex.length;e++){this.getBody().append(this.options.lineFormat(this.filterIndex[this.currentStart+e],this.data[this.filterIndex[this.currentStart+e]]))}this.options.afterRefresh()},setOption:function(e,t){if(e in this.options){this.options[e]=t;if(e==="sort"){this.destroySort();this.createSort();this.triggerSort()}if(e==="sortKey"||e==="sortDir"){this.sort()}if(e==="filters"){this.destroyFilter();this.createFilter()}if(e==="filterText"){this.changePlaceHolder()}this.filter()}},setOptions:function(e){for(var t in e){if(t in this.options){this.options[t]=e[t]}}if("sort"in e){this.destroySort();this.createSort();this.triggerSort()}else if("sortKey"in e||"sortDir"in e){this.sort()}if("filters"in e){this.destroyFilter();this.createFilter()}if("filterText"in e){this.changePlaceHolder()}this.filter()},destroy:function(){if(this.refreshTimeOut!==undefined){clearTimeout(this.refreshTimeOut)}this.destroySort();e(this.options.pagingDivSelector).removeClass("pagination pagination-centered pagination-data-tables").html("");this.destroyFilter();this.table.removeClass(this.options.tableClass);this.getBody().html("");for(var t=0;t<this.data.length;t++){this.getBody().append(this.options.lineFormat(t,this.data[t]))}}};e.fn.datatable=function(){var n=arguments;var r=-1,i;if(n.length===0){n=[{}]}i=this.each(function(){if(e.isPlainObject(n[0])){if(this.datatable===undefined){this.datatable=new t(e(this),e.extend({},e.fn.datatable.defaults,n[0]))}else{this.datatable.setOptions(n[0])}}else if(typeof n[0]==="string"){switch(n[0]){case"page":if(1 in n){this.datatable.loadPage(parseInt(n[1]))}else{r=this.datatable.getCurrentPage()}break;case"select":r=this.datatable.row(n[1]);break;case"insert":this.datatable.addRow(n[1]);break;case"update":this.datatable.updateRow(n[1],n[2]);break;case"delete":this.datatable.deleteRow(n[1]);break;case"option":this.datatable.setOption(n[1],n[2]);break;case"destroy":this.datatable.destroy();delete this.datatable;break}}});return r!==-1?r:i};e.fn.datatable.defaults={tableClass:"datatable",pagingDivSelector:".paging",pagingDivClass:"pagination pagination-centered",pagingListClass:"",counterDivSelector:".counter",loadingDivSelector:".loading",sort:false,sortKey:false,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:false,onChange:function(e,t){},counterText:function(e,t,n,r,i){return"Page "+e+" on "+t+". Starting at "+n+", ending at "+r+" over "+i+" entries."},firstPage:"&lt;&lt;",prevPage:"&lt;",nextPage:"&gt;",lastPage:"&gt;&gt;",filters:{},filterText:"Search... ",filterInputClass:"",filterSelectClass:"",beforeRefresh:function(){},afterRefresh:function(){},lineFormat:function(t,n){var r=e("<tr></tr>");r.data("id",t);for(var i in n){if(n.hasOwnProperty(i)){r.append("<td>"+n[i]+"</td>")}}return r}}})(window.jQuery)